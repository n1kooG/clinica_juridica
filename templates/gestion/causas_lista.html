{% extends 'base.html' %}
{% block title %}Causas{% endblock %}
{% block section_title %}Causas{% endblock %}

{% block content %}
<div class="page-header-flex">
    <div class="page-header-content">
        <h1 class="page-title">Causas</h1>
        <p class="page-subtitle">Seguimiento de causas y consultas jurídicas</p>
    </div>
    {% if puede_crear %}
    <a href="{% url 'gestion:causa_crear' %}" class="btn-primary">
        <i class="fas fa-plus"></i> Nueva causa
    </a>
    {% endif %}
</div>

<div class="list-card">
    <div class="list-card-header">
        <div class="list-card-title">
            <span class="title-text">Listado de causas</span>
            <span class="title-count">{{ causas.count }} causas registradas</span>
        </div>
        <div class="list-card-search">
            <i class="fas fa-search search-icon"></i>
            <input type="text" placeholder="Buscar por RIT, carátula o responsable" class="search-input" id="searchInput">
        </div>
    </div>

    <div class="list-card-filters">
        <a href="?filtro=activas" class="filter-pill {% if filtro == 'activas' or not filtro %}active{% endif %}">Activas</a>
        <a href="?filtro=todas" class="filter-pill {% if filtro == 'todas' %}active{% endif %}">Todas</a>
        <a href="?filtro=archivadas" class="filter-pill {% if filtro == 'archivadas' %}active{% endif %}">Archivadas</a>
    </div>

    <div class="list-card-body">
        <table class="list-table">
            <thead>
                <tr>
                    <th>RIT / RUC</th>
                    <th>Carátula</th>
                    <th>Tribunal</th>
                    <th>Materia</th>
                    <th>Responsable</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            {% for c in causas %}
                <tr>
                    <td class="cell-code">
                        {% if c.rit %}RIT-{{ c.rit }}{% elif c.ruc %}RUC {{ c.ruc }}{% else %}-{% endif %}
                    </td>
                    <td class="cell-name">{{ c.caratula|truncatewords:5 }}</td>
                    <td>{{ c.tribunal|default:"-" }}</td>
                    <td>{{ c.materia|default:"-" }}</td>
                    <td>{{ c.responsable.get_full_name|default:"-" }}</td>
                    <td>
                        {% if c.estado %}
                        <span class="status-badge status-{{ c.estado.color }}">{{ c.estado.nombre }}</span>
                        {% else %}
                        <span class="status-badge status-gray">Sin estado</span>
                        {% endif %}
                    </td>
                    <td class="cell-actions">
                        <a href="{% url 'gestion:causa_detalle' c.pk %}" class="action-link">Ver</a>
                        {% if puede_editar %}
                        <a href="{% url 'gestion:causa_editar' c.pk %}" class="action-link">Editar</a>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="7" class="empty-table">No hay causas registradas.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
document.getElementById('searchInput').addEventListener('keyup', function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll('#tableBody tr');
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
    });
});
</script>
{% endblock %}