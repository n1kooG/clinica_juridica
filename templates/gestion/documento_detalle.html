{% extends 'base.html' %}
{% block title %}{{ documento.titulo }}{% endblock %}
{% block section_title %}Documentos{% endblock %}

{% block content %}
<div class="page-header-with-actions">
    <div class="page-header-left">
        <div class="breadcrumb">
            <a href="{% url 'gestion:documentos_lista' %}">Documentos</a>
            <span class="breadcrumb-separator">/</span>
            <span>Detalle</span>
        </div>
        <h1 class="page-title">{{ documento.titulo }}</h1>
        <p class="page-subtitle">{{ documento.tipo|default:"Documento" }} · {{ documento.causa.caratula }}</p>
    </div>
    <div class="page-header-actions">
        <a href="{% url 'gestion:documentos_lista' %}" class="btn-secondary">Volver</a>
        {% if documento.archivo %}
        <a href="{{ documento.archivo.url }}" class="btn-primary" target="_blank">
            <i class="fas fa-download"></i> Descargar
        </a>
        {% endif %}
    </div>
</div>

<div class="detail-layout">
    <div class="detail-main">
        <!-- Información del documento -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Información del documento</h2>
            </div>
            <div class="card-body">
                <div class="detail-grid">
                    <div class="detail-field">
                        <span class="detail-label">Título</span>
                        <span class="detail-value">{{ documento.titulo }}</span>
                    </div>
                    <div class="detail-field">
                        <span class="detail-label">Tipo</span>
                        <span class="detail-value">{{ documento.tipo|default:"No especificado" }}</span>
                    </div>
                    <div class="detail-field">
                        <span class="detail-label">Estado</span>
                        <span class="detail-value">
                            {% if documento.estado == 'FINAL' %}
                                <span class="status-badge status-green">Final</span>
                            {% elif documento.estado == 'BORRADOR' %}
                                <span class="status-badge status-yellow">Borrador</span>
                            {% elif documento.estado == 'ANULADO' %}
                                <span class="status-badge status-red">Anulado</span>
                            {% else %}
                                <span class="status-badge status-gray">{{ documento.get_estado_display }}</span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="detail-field">
                        <span class="detail-label">Confidencial</span>
                        <span class="detail-value">{% if documento.es_confidencial %}Sí{% else %}No{% endif %}</span>
                    </div>
                    <div class="detail-field full-width">
                        <span class="detail-label">Descripción</span>
                        <span class="detail-value {% if not documento.descripcion %}muted{% endif %}">
                            {{ documento.descripcion|default:"Sin descripción" }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Causa asociada -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Causa asociada</h2>
            </div>
            <div class="card-body">
                <div class="detail-grid">
                    <div class="detail-field">
                        <span class="detail-label">Carátula</span>
                        <span class="detail-value">
                            <a href="{% url 'gestion:causa_detalle' documento.causa.pk %}">{{ documento.causa.caratula }}</a>
                        </span>
                    </div>
                    <div class="detail-field">
                        <span class="detail-label">RIT / RUC</span>
                        <span class="detail-value">{{ documento.causa.rit|default:documento.causa.ruc|default:"-" }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Metadatos judiciales -->
        {% if documento.folio or documento.fecha_emision or documento.numero_documento or documento.emisor %}
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Metadatos judiciales</h2>
            </div>
            <div class="card-body">
                <div class="detail-grid">
                    <div class="detail-field">
                        <span class="detail-label">Folio</span>
                        <span class="detail-value">{{ documento.folio|default:"-" }}</span>
                    </div>
                    <div class="detail-field">
                        <span class="detail-label">Fecha de emisión</span>
                        <span class="detail-value">{{ documento.fecha_emision|date:"d/m/Y"|default:"-" }}</span>
                    </div>
                    <div class="detail-field">
                        <span class="detail-label">Número de documento</span>
                        <span class="detail-value">{{ documento.numero_documento|default:"-" }}</span>
                    </div>
                    <div class="detail-field">
                        <span class="detail-label">Emisor</span>
                        <span class="detail-value">{{ documento.emisor|default:"-" }}</span>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <div class="detail-sidebar">
        <!-- Archivo -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Archivo</h2>
            </div>
            <div class="card-body">
                {% if documento.archivo %}
                <div class="file-preview">
                    <div class="file-icon">
                        {% if documento.es_pdf %}
                            <i class="fas fa-file-pdf"></i>
                        {% elif documento.es_imagen %}
                            <i class="fas fa-file-image"></i>
                        {% else %}
                            <i class="fas fa-file-alt"></i>
                        {% endif %}
                    </div>
                    <div class="file-info">
                        <span class="file-name-preview">{{ documento.archivo.name|slice:"-30" }}</span>
                        <span class="file-ext">{{ documento.extension|upper }}</span>
                    </div>
                    <a href="{{ documento.archivo.url }}" class="btn-primary btn-sm" target="_blank">
                        <i class="fas fa-download"></i> Descargar
                    </a>
                </div>
                {% else %}
                <p class="empty-message">No hay archivo adjunto</p>
                {% endif %}
            </div>
        </div>

        <!-- Información del registro -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Información del registro</h2>
            </div>
            <div class="card-body">
                <div class="contact-quick">
                    <div class="contact-quick-item">
                        <span class="contact-quick-label">Subido por</span>
                        <span class="contact-quick-value">{{ documento.usuario.get_full_name|default:documento.usuario.username|default:"Sistema" }}</span>
                    </div>
                    <div class="contact-quick-item">
                        <span class="contact-quick-label">Fecha de subida</span>
                        <span class="contact-quick-value">{{ documento.fecha_subida|date:"d/m/Y H:i" }}</span>
                    </div>
                    <div class="contact-quick-item">
                        <span class="contact-quick-label">Versión</span>
                        <span class="contact-quick-value">{{ documento.version }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}